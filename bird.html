<html>
    <head>
        <title>Flappy Bird</title>
    </head>
    <body>
        <script src="js/pixi.js" type="text/javascript"></script>
        <script src="js/matter.js" type="text/javascript"></script>
        <script>
            let Engine = Matter.Engine,
            World = Matter.World,
            Bodies = Matter.Bodies;

            let engine = Engine.create();

            const app = new PIXI.Application(288, 512, {backgroundColor : 0x51C0C9});
            document.body.appendChild(app.view);

            app.stop();

            PIXI.loader
                .add('bird')
                .load(onAssetsLoaded);

            let postition = 0,
                ground,
                ground2,
                groundBox,
                sky,
                sky2,
                bird = [],
                birdy,
                birdBox;
                
            app.stage.interactive = true;

            function onAssetsLoaded(loader) {
                const objScale = 1.2;

                ground = PIXI.Sprite.fromImage('assets/world/land.png');
                ground2 = PIXI.Sprite.fromImage('assets/world/land.png');
                ground.width = 336 * objScale;
                ground2.width = 336 * objScale;
                ground.height = 112 * objScale;
                ground2.height = 112 * objScale;
                ground.y = app.renderer.height - ground.height;
                ground2.y = app.renderer.height - ground.height;
                app.stage.addChild(ground, ground2);

                sky = PIXI.Sprite.fromImage('assets/world/sky.png');
                sky2 = PIXI.Sprite.fromImage('assets/world/sky.png');
                sky.width = 276 * objScale;
                sky2.width = 276 * objScale;
                sky.height = 109 * objScale;
                sky2.height = 109 * objScale;
                sky.y = app.renderer.height - ground.height - sky.height;
                sky2.y = app.renderer.height - ground.height - sky2.height;
                app.stage.addChild(sky, sky2);

                for (let i = 0; i < 5; i++) {
                    let num = i + 1;
                    let tmpBird = PIXI.Texture.fromImage('assets/bird/bird-0'+ num +'.png');
                    bird.push(tmpBird);
                    // bird[i].anchor.set(0.5);
                    // bird[i].width = 34 * objScale;
                    // bird[i].height = 24 * objScale;
                    // bird[i].x = (app.renderer.width / 2) + 10;
                    // bird[i].y = (app.renderer.height / 2) + 10;
                    // app.stage.addChild(bird[i]);
                }

                birdy = new PIXI.extras.AnimatedSprite(bird);
                birdy.anchor.set(0.5);
                birdy.x = (app.renderer.width / 2) + 10;
                birdy.y = (app.renderer.height / 2) + 10;
                birdy.scale.set(objScale);
                birdy.animationSpeed = 0.1;
                birdy.loop = false;
                app.stage.addChild(birdy);

                app.stage.on('pointerdown', onTouchStart);

                function onTouchStart() {
                    birdy.play();
                    birdy.onComplete = () => {
                        birdy.gotoAndStop(0);
                        birdy.y -= 10;
                    };
                }

                app.start();
            }

            birdBox = Bodies.rectangle(((app.renderer.width / 2) + 10), ((app.renderer.height / 2) + 10), 80, 80);
            groundBox = Bodies.rectangle(0, 473, 336 * 1.2, 112 * 1.2, { isStatic: true });

            app.ticker.add(function() {
                postition += 1;

                birdy.position.x = birdBox.position.x;
                birdy.position.y = birdBox.position.y;
                birdy.rotation = birdBox.angle;

                sky.x = -(postition * 0.6);
                sky.x %= sky.width * 2;
                if (sky.x < 0) {
                    sky.x += sky.width * 2;
                }
                sky.x -= sky.width;
                
                sky2.x = -(postition * 0.6) + sky2.width;
                sky2.x %= sky2.width * 2;
                if(sky2.x < 0) {
                    sky2.x += sky2.width * 2;
                }
                sky2.x -= sky2.width;

                ground.x = -(postition * 0.6);
                ground.x %= ground.width * 2;
                if (ground.x < 0) {
                    ground.x += ground.width * 2;
                }
                ground.x -= ground.width;
                
                ground2.x = -(postition * 0.6) + ground2.width;
                ground2.x %= ground2.width * 2;
                if(ground2.x < 0) {
                    ground2.x += ground2.width * 2;
                }
                ground2.x -= ground2.width;
            });

            World.add(engine.world, [birdBox, groundBox]);
            Engine.run(engine);
        </script>
    </body>
</html>

